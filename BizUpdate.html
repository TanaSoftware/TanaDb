<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/main.css" rel="stylesheet">
    <link href="css/selectize.css" rel="stylesheet" />
    <style>
        .hour {
            width: 70px;
        }

        .tooltip-inner {
            background-color: #f00 !important;
        }

        .btn {
            background: #33a6cc;
            box-shadow: 1px;
            color: #ffffff;
        }

        @media only screen and (max-width: 760px) {

            input[type=checkbox] {
                /* Double-sized Checkboxes */
                -ms-transform: scale(1.5); /* IE */
                -moz-transform: scale(1.5); /* FF */
                -webkit-transform: scale(1.5); /* Safari and Chrome */
                -o-transform: scale(1.5); /* Opera */
                transform: scale(1.5);
                padding-left: 20px !important;
            }
        }

        .checkbox-inline {
            padding-left: 5px !important;
        }
    </style>
</head>
<body dir="rtl">
    <section id="Register" style="padding-top:100px;padding:10px;">

        <div class="container ">

            <div class="row">

                <div class="">

                    <div class="panel panel-primary">
                        <div class="panel-heading">
                            <h3 class="panel-title">
                                עדכון פרטי בעל העסק
                                <span style="float:left;"><button onclick="goBack()">חזרה</button></span>
                            </h3>
                        </div>

                        <div class="panel-body">

                            <div class="form-group">

                                <div class="form-group floating-label-form-group controls">

                                    <input id="name" type="text" placeholder="שם" class="form-control input-lg" />

                                </div>

                            </div>

                            <div class="form-group">

                                <div class="form-group floating-label-form-group controls">

                                    <input id="password" type="password" placeholder="סיסמה" class="form-control input-lg" />

                                </div>

                            </div>

                            <div class="form-group">

                                <div class="form-group floating-label-form-group controls">

                                    <input id="email" type="email" placeholder="מייל" class="form-control input-lg" />

                                </div>

                            </div>

                            <div class="form-group">

                                <div class="form-group floating-label-form-group controls">

                                    <input id="txtTel" type="text" placeholder="טלפון" class="form-control input-lg" />

                                </div>

                            </div>

                            <div class="form-group">

                                <div class="form-group floating-label-form-group controls">

                                    <input id="bizName" type="text" placeholder="שם עסק בעברית" class="form-control input-lg" />

                                </div>

                            </div>

                            <div class="form-group">

                                <div class="form-group floating-label-form-group controls">

                                    <input id="bizNameEng" type="text" placeholder="שם עסק באנגלית" class="form-control input-lg" />

                                </div>

                            </div>

                            <!--<div class="form-group">

                                <div class="form-group floating-label-form-group controls">

                                    <input id="creditCard" type="text" placeholder="כרטיס אשראי" class="form-control input-lg" />

                                </div>

                            </div>-->

                            <div class="form-group">

                                <div class="form-group floating-label-form-group controls">

                                    <input id="address" type="text" placeholder="כתובת" class="form-control input-lg" />

                                </div>

                            </div>

                            <div class="form-group">

                                <div class="form-group floating-label-form-group controls">

                                    <select id="city" type="text" placeholder="כתובת"></select>

                                </div>

                            </div>
                            <div class="form-group" style="float:left;">

                                <div id="dvProgBar" style="text-align:center;display:none;"><img src="css/ProgressBlue.gif" /></div>

                                <div id="dvErrRegister"></div>

                                <button onClick="Save();" class="btn btn-blue btn-lg">שמירה</button>

                            </div>
                        </div>
                    </div>

                    <div class="panel panel-primary">
                        <div class="panel-heading">
                            <h3 class="panel-title">סוגי פעילויות</h3>
                        </div>

                        <div class="panel-body">
                            <div style="text-align:right">
                                <label></label><span style="color:red" id="spnActiveDays"></span>

                                <div class="row" style="width:100%" id="UserActivities"></div>

                                <div class="form-group" style="width:100%;padding-bottom:10px;padding-top:10px;">

                                    <input style="float:right;width:120px;margin-bottom:10px;margin-right:3px;" maxlength="50" id="BizType" type="text" placeholder="הזן סוג פעילות" class="form-control input-lg" />
                                    <input style="float:right;width:80px;margin-right:4px;" id="txtDuration" type="number" placeholder="משך פעילות" maxlength="3" class="form-control input-lg" />
                                    <!--<select id="ddlDuration" style="float:right;min-width:80px;max-width:140px; margin-right:3px;" placeholder="משך פעילות" class="form-control input-lg">

                                        <option value="0">משך פעילות</option>

                                        <option>10</option>

                                        <option>20</option>

                                        <option>30</option>

                                        <option>40</option>

                                        <option>50</option>

                                        <option>60</option>

                                    </select>-->
                                    <button onclick="AddUserActivity();" class="btn btn-blue btn-lg" style="float:right; margin-right:5px;">הוסף</button>

                                </div>
                                <div style="width:100%;padding-top:5px;float:right">
                                    <label>ימי פעילות עובד</label><span style="color:red" id="spnActiveDays"></span>
                                </div>

                                <div class="row" style="width:100%" id="Activities"></div>

                                <div style="width:100%;padding-bottom:10px;padding-top:10px;">

                                    <input style="float:right;width:180px;margin-bottom:10px;margin-right:3px;" maxlength="50" id="EmployeeName" type="text" placeholder="הזן שם עובד" class="form-control input-lg" />

                                    <button onclick="AddActivity();" class="btn btn-blue btn-lg" style="float:right;margin-right:5px;">הוסף</button>

                                </div>

                                <table class="table table-striped table-bordered">
                                    <tr>
                                        <td>יום</td>
                                        <td>שעות פעילות</td>
                                        <td>שעות לא פעילות</td>
                                    </tr>
                                    <tr>
                                        <td style="width:100px;">
                                            <input type="checkbox" id="Day1"> א
                                        </td>
                                        <td>
                                            <div class="form-group floating-label-form-group controls">
                                                <input id="txtfromHour1" data-toggle="tooltip" trigger="manual" data-placement="top" style="width:70px;" type="text" placeholder="משעה" class="form-control input-time" />
                                            </div>
                                            <div class="form-group floating-label-form-group controls">
                                                <input id="txttoHour1" placeholder="עד שעה" style="width:70px;" type="text" class="form-control input-time" />
                                            </div>
                                        </td>
                                        <td>
                                            <div class="form-group floating-label-form-group controls">
                                                <input id="txtfromHourNone1" style="width:70px;" type="text" placeholder="משעה" class="form-control input-time" />
                                            </div>
                                            <div class="form-group floating-label-form-group controls">
                                                <input id="txttoHourNone1" style="width:70px;" type="text" placeholder="עד שעה" class="form-control input-time" />
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="width:100px;"><input type="checkbox" id="Day2"> ב</td>
                                        <td>
                                            <div class="form-group floating-label-form-group controls">
                                                <input id="txtfromHour2" style="width:70px;" type="text" placeholder="משעה" class="form-control input-time" />
                                            </div>
                                            <div class="form-group floating-label-form-group controls">
                                                <input id="txttoHour2" style="width:70px;" type="text" placeholder="עד שעה" class="form-control input-time" />
                                            </div>
                                        </td>
                                        <td>
                                            <div class="form-group floating-label-form-group controls">
                                                <input id="txtfromHourNone2" style="width:70px;" type="text" placeholder="משעה " class="form-control input-time" />
                                            </div>
                                            <div class="form-group floating-label-form-group controls">
                                                <input id="txttoHourNone2" style="width:70px;" type="text" placeholder="עד שעה" class="form-control input-time" />
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="width:100px;"><input type="checkbox" id="Day3"> ג</td>
                                        <td>
                                            <div class="form-group floating-label-form-group controls">
                                                <input id="txtfromHour3" style="width:70px;" type="text" placeholder="משעה" class="form-control input-time" />
                                            </div>
                                            <div class="form-group floating-label-form-group controls">
                                                <input id="txttoHour3" style="width:70px;" type="text" placeholder="עד שעה" class="form-control input-time" />
                                            </div>
                                        </td>
                                        <td>
                                            <div class="form-group floating-label-form-group controls">
                                                <input id="txtfromHourNone3" style="width:70px;" type="text" placeholder="משעה " class="form-control input-time" />
                                            </div>
                                            <div class="form-group floating-label-form-group controls">
                                                <input id="txttoHourNone3" style="width:70px;" type="text" placeholder="עד שעה" class="form-control input-time" />
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="width:100px;"><input type="checkbox" id="Day4"> ד</td>
                                        <td>
                                            <div class="form-group floating-label-form-group controls">
                                                <input id="txtfromHour4" style="width:70px;" type="text" placeholder="משעה" class="form-control input-time" />
                                            </div>
                                            <div class="form-group floating-label-form-group controls">
                                                <input id="txttoHour4" style="width:70px;" type="text" placeholder="עד שעה" class="form-control input-time" />
                                            </div>
                                        </td>
                                        <td>
                                            <div class="form-group floating-label-form-group controls">
                                                <input id="txtfromHourNone4" style="width:70px;" type="text" placeholder="משעה " class="form-control input-time" />
                                            </div>
                                            <div class="form-group floating-label-form-group controls">
                                                <input id="txttoHourNone4" style="width:70px;" type="text" placeholder="עד שעה" class="form-control input-time" />
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="width:100px;"><input type="checkbox" id="Day5"> ה</td>
                                        <td>
                                            <div class="form-group floating-label-form-group controls">
                                                <input id="txtfromHour5" style="width:70px;" type="text" placeholder="משעה" class="form-control input-time" />
                                            </div>
                                            <div class="form-group floating-label-form-group controls">
                                                <input id="txttoHour5" style="width:70px;" type="text" placeholder="עד שעה" class="form-control input-time" />
                                            </div>
                                        </td>
                                        <td>
                                            <div class="form-group floating-label-form-group controls">
                                                <input id="txtfromHourNone5" style="width:70px;" type="text" placeholder="משעה " class="form-control input-time" />
                                            </div>
                                            <div class="form-group floating-label-form-group controls">
                                                <input id="txttoHourNone5" style="width:70px;" type="text" placeholder="עד שעה" class="form-control input-time" />
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="width:100px;"><input type="checkbox" id="Day6"> ו</td>
                                        <td>
                                            <div class="form-group floating-label-form-group controls">
                                                <input id="txtfromHour6" style="width:70px;" type="text" placeholder="משעה" class="form-control input-time" />
                                            </div>
                                            <div class="form-group floating-label-form-group controls">
                                                <input id="txttoHour6" style="width:70px;" type="text" placeholder="עד שעה" class="form-control input-time" />
                                            </div>
                                        </td>
                                        <td>
                                            <div class="form-group floating-label-form-group controls">
                                                <input id="txtfromHourNone6" style="width:70px;" type="text" placeholder="משעה " class="form-control input-time" />
                                            </div>
                                            <div class="form-group floating-label-form-group controls">
                                                <input id="txttoHourNone6" style="width:70px;" type="text" placeholder="עד שעה" class="form-control input-time" />
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="width:100px;"><input type="checkbox" id="Day7"> ז</td>
                                        <td>
                                            <div class="form-group floating-label-form-group controls">
                                                <input id="txtfromHour7" style="width:70px;" type="text" placeholder="משעה" class="form-control input-time" />
                                            </div>
                                            <div class="form-group floating-label-form-group controls">
                                                <input id="txttoHour7" style="width:70px;" type="text" placeholder="עד שעה" class="form-control input-time" />
                                            </div>
                                        </td>
                                        <td>
                                            <div class="form-group floating-label-form-group controls">
                                                <input id="txtfromHourNone7" style="width:70px;" type="text" placeholder="משעה " class="form-control input-time" />
                                            </div>
                                            <div class="form-group floating-label-form-group controls">
                                                <input id="txttoHourNone7" style="width:70px;" type="text" placeholder="עד שעה" class="form-control input-time" />
                                            </div>
                                        </td>
                                    </tr>


                                </table>

                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <ul>
                    באפשרותך להעלאות שני תמונות לאתר שלך:
                    <li>
                        <span style="float:right;width:70px;">לוגו: </span><input style="float:right;" id="fileupload1" name="myfile1" type="file" />
                        <span style="float:right;margin-right:20px;">(גודל מומלץ 100/25)</span>
                    </li>
                    <li>
                        <span style="float:right;width:70px;">תמנת רקע</span><input style="float:right;" id="fileupload2" name="myfile2" type="file" />
                        <span style="float:right;margin-right:20px;">(גודל מומלץ 600/400)</span>
                    </li>
                </ul>
                <ul>
                    <li><button style="float:right;" onclick="upload()">העלאת תמונות</button></li>
                </ul>
            </div>
        </div>

    </section>
    <script src="js/jquery.js"></script>
    <script src="js/cleave.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.easing.min.js"></script>
    <script src="js/jquery.countdown.min.js"></script>
    <script src="js/device.min.js"></script>
    <script src="js/form.min.js"></script>
    <script src="js/jquery.placeholder.min.js"></script>
    <script src="js/jquery.shuffle.min.js"></script>
    <script src="js/jquery.parallax.min.js"></script>
    <script src="js/jquery.circle-progress.min.js"></script>
    <script src="js/jquery.swipebox.min.js"></script>
    <script src="js/smoothscroll.min.js"></script>
    <script src="js/wow.min.js"></script>
    <script src="js/main.js"></script>
    <script src="js/selectize.js"></script>

    <script src="https://www.negishim.com/accessibility/accessibility_pro.js" type="text/javascript"></script>
</body>
</html>
<script>
    accessibility_rtl = false;
    pixel_from_side = 10;
    pixel_from_start = 80;
    is_set_for_mobile = 1;
    var UserData = JSON.parse(sessionStorage.getItem("UserData"));
    getScripts();

    function getScripts() {
        var v = sessionStorage.getItem("version");
        $.ajax({
            url: "js/global.js?ver=" + v,
            dataType: "script",
            success: function (data) {

                getCities(function (data) {
                    selectizeService.InitSelectize("city", 'Id', 'Name', 46, data, null);

                    GetUserDetails();
                });


            }
        });


    }


    function GetUserDetails() {

        var Obj = {
            guid: UserData.guid
        }
        $.ajax({
            url: "User/GetUserDetails",
            type: 'POST',
            data: JSON.stringify(Obj),
            contentType: "application/json;charset=utf-8",
            success: function (data) {
                if(data.ErrorMsg!=null && data.ErrorMsg!=""){

                }
                else {
                    fillData(data);
                }
            },
            error: function (request, status, error) {

            }
        });
    }

    function getActivityNameByById(id){
        for (var i = 0; i < UserData.Activities.length; i++) {
            if (UserData.Activities[i].Id == id)
                return UserData.Activities[i].Name;
        }
    }
    function checkEmployeeActivities(EmployeeActivities,id){
        for (var i = 0; i < EmployeeActivities.length; i++) {
            if (EmployeeActivities[i] == id)
                return true;
        }
        return false;
    }
    function getEmployeeTemplate(EmployeeId, EmployeeName, EmployeeActivities) {

        var ret = "<div class='row' style='width:100%;' id='dvBizType" + EmployeeId + "'><div style='float:right;padding-right:20px;'><input style='width:140px;' onclick=SetEmployeeData('" + EmployeeName + "'); id='txtBizType" + EmployeeId + "' type='text' value='" + EmployeeName + "' /></div><button style='float:right;margin-right:4px;' onclick=deleteBizType('" + EmployeeId + "')>מחק</button><button style='float:right;margin-right:4px;' onclick=UpdateBizType('" + EmployeeId + "')>עדכן</button></div>";
        for (var i = 0; i < UserData.Activities.length; i++) {
            var bizType = UserData.Activities[i].Name;
            var checked = "";
            if (checkEmployeeActivities(EmployeeActivities,UserData.Activities[i].Id))
                checked = "checked='checked'";
            ret += getEmployeeActivityTemplate(EmployeeId,UserData.Activities[i].Id, bizType, checked);
        }
        return ret;
    }


    function getEmployeeActivityTemplate(EmployeeId,Id, bizType, checked){
        return "<div id='dvActEmp" + EmployeeId + "Act" + Id + "' style='padding-right:20px;'><label style='width:120px;' for='chk_" + EmployeeId + "Act" + Id + "'>" + bizType + "</label><input " + checked + " id='chk_" + EmployeeId + "Act" + Id + "' type='checkbox' value='" + bizType + "' /></div>";
    }

    function getBizTypeTemplate(Id, Name, ActiveDuration) {
        return "<div class='row' style='width:100%;' id='dvBizTypeAct" + Id + "'><div style='float:right;width:200px;padding-right:20px;'>" + Name + " למשך  " + ActiveDuration + " דקות</div><button style='float:right;margin-right:4px;' onclick=deleteBizTypeActivity('" + Id + "')>מחק</button></div>";
    }

    function fillData(data) {

        var ud = data.userDetailsData;
        $('#address').val(ud.Adrress);
        $('#bizName').val(ud.BizName);
        $('#bizNameEng').val(ud.BizNameEng);
        //$('#city').val(ud.City);
        selectizeService.setValue('city', ud.City);
        $('#email').val(ud.Email);
        $('#txtTel').val(ud.Tel);
        $('#name').val(ud.User);
        var empData = "";
        var BizTypeData = "";

        for (var i = 0; i < UserData.Activities.length; i++) {
            BizTypeData += getBizTypeTemplate(UserData.Activities[i].Id, UserData.Activities[i].Name, UserData.Activities[i].ActiveDuration);
        }
        $("#UserActivities").html(BizTypeData);

        for (var key in UserData.dicBizType) {
            var arr = UserData.dicBizType[key];
            empData += getEmployeeTemplate(arr[0].EmployeeId, arr[0].EmployeeName, UserData.dicEmployeeActivities[arr[0].EmployeeId]);
        }
        $("#Activities").html(empData);

    }

    function SetEmployeeData(key) {
        var arr = UserData.dicBizType[key];
        for (var i = 1; i <=7; i++) {
            document.getElementById('Day' + i).checked = false;
            $('#txtfromHour' + i).val("");

            $('#txttoHour' + i).val("");

            $('#txtfromHourNone' + i).val("");

            $('#txttoHourNone' + i).val("");
        }
        for (var i = 0; i < arr.length; i++) {

            var id = arr[i].ActiveDay;

            document.getElementById('Day' + id).checked = true;

            $('#txtfromHour' + id).val(arr[i].ActiveHourFrom);

            $('#txttoHour' + id).val(arr[i].ActiveHourTo);

            $('#txtfromHourNone' + id).val(arr[i].ActiveHourFromNone);

            $('#txttoHourNone' + id).val(arr[i].ActiveHourFromNone);

        }
    }

    function deleteBizTypeActivity(BizTypeId) {
        messageHandler.Confirm("מחיקה זו תמחוק את כל התורים שקיימים לפעילות הנ''ל, האם ברצונך להמשיך?",
            function () { deleteActivityFromDb(BizTypeId); }, function () { CanceldeleteActivity(); });
    }

    function CanceldeleteActivity() {
        $('#dvConfirmModal').modal('hide');
    }
    function deleteActivityFromDb(BizTypeId) {

        $('#dvConfirmModal').modal('hide');
        var Obj = {
            guid: UserData.guid,
            UserId: BizTypeId
        }

        $.ajax({
            url: "User/DeleteUserActivity",
            type: 'POST',
            data: JSON.stringify(Obj),
            contentType: "application/json;charset=utf-8",
            success: function (data) {
                if (data != null && data != "") {
                    messageHandler.Show(data);
                }
                else {
                    $('#dvBizTypeAct' + BizTypeId).remove();
                    var iFountIt = -1;
                    messageHandler.Show("שם פעילות נמחק בהצלחה");
                    for (var i = 0; i < UserData.Activities.length; i++) {
                        if (UserData.Activities[i].Id == BizTypeId) {
                            iFountIt = i;
                            break;
                        }
                    }
                    if (iFountIt >= 0) {
                        UserData.Activities.splice(iFountIt, 1);
                    }
                    for (var key in UserData.dicBizType) {
                        $('#dvActEmp' + UserData.dicBizType[key][0].EmployeeId + 'Act' + BizTypeId).remove();
                    }
                }
            },
            error: function (request, status, error) {

            }
        });
    }
    function AddActivity() {

        var data = "";
        var ActivitiesData = {};
        var ActivitiesTempData = new Array();
        var empName = $('#EmployeeName').val();
        if (!checkValid("EmployeeName", "נא להזין שם עובד")) {

            return;

        }

        ActivitiesTempData = getEmployeeHours(0);
        if (ActivitiesTempData.length <= 0)
            return;

        $.ajax({
            url: "User/AddEmployee",
            type: 'POST',
            data: JSON.stringify(ActivitiesTempData),
            contentType: "application/json;charset=utf-8",
            success: function (data) {
                if (data != null && data.msg != "") {

                    messageHandler.Show(data.msg);

                }
                else {
                    var empData = getEmployeeTemplate(data.EmployeeId, empName);
                    var newDiv = $("#Activities").html();
                    $("#Activities").html(newDiv + empData);
                    $('#EmployeeName').val("");

                    var dicBizType = UserData.dicBizType;
                    dicBizType[empName] = ActivitiesTempData;
                    UserData.dicBizType = dicBizType;
                    sessionStorage.setItem("UserData", JSON.stringify(UserData));
                    messageHandler.Show(" עובד חדש התווסף בהצלחה");
                }
            },
            error: function (request, status, error) {

            }
        });


    }

    function getEmployeeHours(EmployeeId, employeeName) {
        var ActivitiesTempData = new Array();
        var empName = employeeName ? employeeName :$('#EmployeeName').val();
        var dicBizType = UserData.dicBizType;
        if (employeeName==null && dicBizType[empName] != null) {
            showTooltip("EmployeeName", "שם עובד קיים")
            return;
        }
        for (var i = 1; i <= 7; i++) {

            var id = i.toString();

            var Day = document.getElementById('Day' + id).checked;


            if (Day) {

                if (!checkValid("txtfromHour" + id, "נא להזין משעה")) {

                    return;

                }

                if (!checkHour("txtfromHour" + id, "שעה לא חוקית")) {

                    return;

                }

                if (!checkValid("txttoHour" + id, "נא להזין עד שעה")) {

                    return;

                }

                if (!checkHour("txttoHour" + id)) {

                    return;

                }

                var item = GetBizTypeItem();

                item.UserId = UserData.UserId;
                if(i==1)
                    item.guid = UserData.guid;

                item.EmployeeId = EmployeeId;
                item.EmployeeName = empName;

                item.ActiveDay = id;

                item.ActiveHourFrom = $('#txtfromHour' + id).val();

                item.ActiveHourTo = $('#txttoHour' + id).val();

                item.ActiveHourFromNone = $('#txtfromHourNone' + id).val() == "" ? null : $('#txtfromHourNone' + id).val();

                item.ActiveHourToNone = $('#txttoHourNone' + id).val() == "" ? null : $('#txttoHourNone' + id).val();

                ActivitiesTempData.push(item);
            }

        }

        if (ActivitiesTempData.length <= 0) {
            if (!document.getElementById('Day1').checked) {
                showTooltip("Day1", "נא לסמן לפחות יום אחד בשבוע")
                return;
            }
            if ($('#txtfromHour1').val() == "") {
                showTooltip("txtfromHour1", "נא להזין שעת פעילות")
                return;
            }
            if ($('#txttoHour1').val() == "") {
                showTooltip("txttoHour1", "נא להזין שעת פעילות")
                return;
            }
        }
        return ActivitiesTempData;
    }

    function GetBizTypeItem() {

        return { guid:"", UserId:0,EmployeeId: 0, ActiveDay: 0, EmployeeName: "", ActiveHourFrom: "", ActiveHourTo: "", ActiveHourFromNone: "", ActiveHourToNone: "" };

    }

    function deleteBizTypeFromDb(empId) {

        $('#dvConfirmModal').modal('hide');
        var Obj = {
            guid: UserData.guid,
            UserId: UserData.UserId,
            EmployeeId: empId
        }

        $.ajax({
            url: "User/DeleteEmployee",
            type: 'POST',
            data: JSON.stringify(Obj),
            contentType: "application/json;charset=utf-8",
            success: function (data) {
                if (data != null && data != "") {

                    messageHandler.Show(data);

                }
                else {
                    var empName = $('#txtBizType' + empId).val();
                    var dicBizType = UserData.dicBizType;
                    delete dicBizType[empName];
                    UserData.dicBizType = dicBizType;
                    sessionStorage.setItem("UserData", JSON.stringify(UserData));
                    $('#dvBizType' + empId).remove();
                    messageHandler.Show("שם עובד נמחק בהצלחה");
                }
            },
            error: function (request, status, error) {

            }
        });
    }

    function CanceldeleteBizType(){
        $('#dvConfirmModal').modal('hide');
    }
    function deleteBizType(empId) {

        messageHandler.Confirm("מחיקה זו תמחוק את כל התורים שקיימים לעובד הנ''ל, האם ברצונך להמשיך?",
            function () { deleteBizTypeFromDb(empId); }, function () { CanceldeleteBizType(); });


    }

    function UpdateBizType(empId) {

        var empName = $("#txtBizType" + empId).val();

        if (empName == null || empName == "") {
            showTooltip("txtBizType" + empId, "נא להזין שם עובד");
            return;
        }

        var ActivitiesTempData = getEmployeeHours(empId, empName);
        if (ActivitiesTempData==null || ActivitiesTempData.length <= 0)
            return;

        var arrActs = [];

        for (var i = 0; i < UserData.Activities.length; i++) {
            if ($("#chk_" + empId + "Act" + UserData.Activities[i].Id).is(":checked")) {
                arrActs.push({ UserId:UserData.UserId, EmployeeId: empId, ActivityId: UserData.Activities[i].Id, IsChecked: true });
            }
            else
                arrActs.push({ UserId: UserData.UserId, EmployeeId: empId, ActivityId: UserData.Activities[i].Id, IsChecked: false });
        }
        var dataWrap = { ActivitiesData: ActivitiesTempData, checkedActivities: arrActs };

        $.ajax({
            url: "User/UpdateEmployee",
            type: 'POST',
            data: JSON.stringify(dataWrap),
            contentType: "application/json;charset=utf-8",
            success: function (data) {
                if (data != null && data != "") {
                    messageHandler.Show(data);
                }
                else {
                    var dicBizType = UserData.dicBizType;
                    dicBizType[empName] = ActivitiesTempData;
                    UserData.dicBizType = dicBizType;
                    sessionStorage.setItem("UserData", JSON.stringify(UserData));
                    messageHandler.Show("שם עובד עודכן בהצלחה");
                }
            },
            error: function (request, status, error) {

            }
        });

    }

    function Save() {

        var user = $("#name").val();

        var password = $("#password").val();

        var email = $("#email").val();

        var bizName = $("#bizName").val();

        var bizNameEng = $("#bizNameEng").val();

        //var creditCard = $("#creditCard").val();

        var address = $("#address").val();

        var city = $("#city").val();

        var tel = $("#txtTel").val();

        $("#spnActiveDays").text("");


        if (user.length <= 0) {

            showTooltip("name", "נא להזין שם");

            return;

        }


        if (password && password.length > 0 && password.length < 8) {

            showTooltip("password", "נא להזין לפחות 8 תווים");

            return;

        }
        if (password && !testPassword(password)) {
            showTooltip("password", "נא להזין תווים ומספרים");

            return;
        }
        if (email.length <= 0) {

            showTooltip("email", "נא להזין מייל");

            return;

        }

        if (tel.length <= 0) {

            showTooltip("txtTel", "נא להזין מספר טלפון נייד");

            return;

        }

        if (!IsvalidEmail(email)) {

            showTooltip("email", "נא להזין מייל תקין");

            return;

        }



        if (bizName.length <= 0) {

            showTooltip("bizName", "נא להזין שם עסק");

            return;

        }



        if (bizNameEng.length <= 0) {

            showTooltip("bizNameEng", "נא להזין שם עסק באנגלית");

            return;

        }



        //if (creditCard.length <= 0) {

        //    showTooltip("creditCard", "נא להזין כרטיס אשראי ");

        //    return;

        //}



        if (address.length <= 0) {

            showTooltip("address", "נא להזין כתובת");

            return;

        }



        if (city == "0") {

            showTooltip("city", "נא להזין עיר");

            return;

        }



        var userObj = {
            Id: UserData.UserId,
            User: user,

            Password: password,

            Email: email,

            tel: tel,

            BizName: bizName,

            BizNameEng: bizNameEng,

            Adrress: address,

            City: city,

            Country: "Israel",
            guid:UserData.guid
        }


        $.ajax({
            url: "User/SaveUser",
            type: 'POST',
            data: JSON.stringify(userObj),
            contentType: "application/json;charset=utf-8",
            success: function (data) {

                messageHandler.Show(data);

            },
            error: function (request, status, error) {

            }
        });
    }

    function AddUserActivity() {

        var data = "";

        var ActivitiesTempData = new Array();
        var bizType = $('#BizType').val();
        if (bizType.length == 0) {
            showTooltip("BizType", "נא להזין שם פעילות");
            return;
        }

        if (!checkValid("txtDuration", "נא להזין משך פעילות")) {
            return;
        }


        var duration = $("#txtDuration").val();
        if (parseInt(duration <= 0)) {
            showTooltip("txtDuration", "נא להזין מספר גדול מאפס");
            return;
        }
        if (duration.length > 3) {
            showTooltip("txtDuration", "נא להזין מקסימום 720 דקות");
            return;
        }
        var Obj = {
            UserId: UserData.UserId,
            Name: bizType,
            ActiveDuration: duration,
            guid:UserData.guid
        };
        $.ajax({
            url: "User/AddUserActivity",
            type: 'POST',
            data: JSON.stringify(Obj),
            contentType: "application/json;charset=utf-8",
            success: function (data) {
                if (data == 0) {
                    messageHandler.Show("ארעה שגיאה בהוספת פעילות");
                }
                else {
                    var newBizDiv = getBizTypeTemplate(data, bizType, duration);
                    var newDiv = $("#UserActivities").html();

                    $("#UserActivities").html(newDiv + newBizDiv);

                    for (var key in UserData.dicBizType) {
                        var arr = UserData.dicBizType[key];
                        var d = getEmployeeActivityTemplate(arr[0].EmployeeId,data, bizType, "");
                        var lastActivityId = UserData.Activities[UserData.Activities.length - 1].Id;

                        $(d).insertAfter("#dvActEmp" + arr[0].EmployeeId + "Act" + lastActivityId );
                    }
                    UserData.Activities[UserData.Activities.length] = { Id: data, Name: bizType, ActiveDuration: parseInt(duration) };

                    $('#BizType').val("");
                    $('#txtDuration').val("");
                    messageHandler.Show("פעילות עודכנה בהצלחה");
                }
            },
            error: function (request, status, error) {

            }
        });


        }
    SetHourToDddl();

    function SetHourToDddl() {
        document.querySelectorAll('.input-time').forEach(function (el) {
            new Cleave(el,
                {
                    time: true,
                    timePattern: ["h", "m"]
                });
        });

    }


    function upload() {
        var formData = new FormData();
        var file = document.getElementById('fileupload1').files[0];
        var file2 = document.getElementById('fileupload2').files[0];
        formData.append("file", file, file.name);
        formData.append("file2", file2, file2.name);
        formData.append("userId", UserData.UserId);
        formData.append("guid", UserData.guid);

        $.ajax({
            url: "Image/UploadImage",
            type: 'POST',
            data: formData,
            cache: false,
            contentType: false,
            processData: false,
            success: function (data) {
                messageHandler.Show("תמונה עודכנה בהצלחה");
            },
            error: function (request, status, error) {
                messageHandler.Show(error);
            }
        });


    }
</script>